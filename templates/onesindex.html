<!DOCTYPE html>
<!-- saved from url=(0025)http://simple.yangqq.com/ -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>个人博客</title>
    <meta name="keywords" content="simple个人博客模板">
    <meta name="description" content="simple个人博客模板">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/base.css" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
    <link href="/static/css/m.css" rel="stylesheet">
    <link href="/static/css/pagenation.css" rel="stylesheet">
</head>
<body>
<header class="header-navigation" id="header">
    <nav>
        <div class="logo">
            <a href="http://simple.yangqq.com/">{{ user.username }}个人博客</a>
        </div>
        <h2 id="mnavh"><span class="navicon"></span></h2>
        <ul id="starlist">
            <li><a href='/onesindex/{{ blog.surfix }}' id="selected">首页</a></li>

            <li><a href="#">相册</a></li>


            <li><a href="#">留言</a></li>


            <li><a href="#">关于</a></li>

        </ul>
        <div class="searchbox">
            <div id="search_bar" class="search_bar">
                <form id="searchform" action="http://simple.yangqq.com/e/search/index.php" method="post"
                      name="searchform">
                    <input class="input" placeholder="想搜点什么呢.." type="text" name="keyboard" id="keyboard">
                    <input type="hidden" name="show" value="title">
                    <input type="hidden" name="tempid" value="1">
                    <input type="hidden" name="tbname" value="news">
                    <input type="hidden" name="Submit" value="搜索">
                    <p class="search_ico"><span></span></p>
                </form>
            </div>
        </div>
    </nav>
</header>

{# 上传头像的模态框   #}
<div class="modal fade" id="postAvatar" tabindex="-1" role="dialog" style="position: absolute;top: 200px">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">图片上传</h4>
            </div>
            <div class="modal-body">
                <form action="/index/{{ user.blog.surfix }}/PostAvatar/" id="drop-avatar" class="dropzone"
                      enctype="multipart/form-data">
                    {% csrf_token %}
                    {#                        <p class="btn-success">请将文件拖拽至此处!(图片大小不得超过10MB)</p>#}
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="FinalImg()">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{# 更改头像的模态框   #}
<div class="modal fade" id="changeAvatar" tabindex="-1" role="dialog" style="position: absolute;top: 200px">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">更换头像</h4>
            </div>
            <div class="modal-body">
                {% if user.img %}
                    <img class="glyphicon-file" id="previewAvatar_img" src="/{{ user.img.url }}"
                         style="width: 100px;height: 100px">
                {% else %}
                    <img class="glyphicon-file" id="previewAvatar_img" src="" style="width: 100px;height: 100px">
                {% endif %}
                <form action="/index/{{ user.blog.surfix }}/ChangeAvatar/" id="ChangeAvatarForm" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" name="Avatarfile" class="form-control" onchange="previewAvatar(this)"
                           accept="image/*">
                    <span class="btn-warning">（头像大小不能超过10MB）</span>
                    <input type="hidden" name="bid" value="{{ user.blog.bid }}">
                     <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <input type="submit" value="提交"  class="btn btn-primary" >
                    </div>
                </form>

            </div>


        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<article style="position: relative;">
    <aside class="l_box" style="position: relative; left: auto; width: 30%;">
        <div class="about_me">
            <h2>关于</h2>
            <ul>
                {#                <i><img src="/static/img/onesblog/p1.jpg"></i>#}
                {% if user.img %}
                    <i><img src=/{{ user.img.url }}>
                        <button id="change-user-avatar" class="btn btn-primary" data-toggle="modal"
                                data-target='#changeAvatar'>更改头像
                        </button>
                    </i>
                {% else %}
                    <button id="postAvatarBtn" class="btn btn-primary" data-toggle="modal" data-target="#postAvatar">
                        上传头像
                    </button>
                {% endif %}
                <p><b>{{ user.username }}  </b>知难而上</p>
            </ul>
        </div>
        <div class="wdxc">
            <h2>相册</h2>
            <ul>
                <li><a href="http://simple.yangqq.com/photo/21.html" title="古典个人博客模板《青砖屋檐》"><img
                        src="/static/img/onesblog/text02.jpg"></a></li>
                <li><a href="http://simple.yangqq.com/photo/20.html" title="个人博客模板《早安》"><img
                        src="/static/img/onesblog/b02.jpg"></a></li>
                <li><a href="http://simple.yangqq.com/photo/7.html" title="简单手工纸玫瑰"><img
                        src="/static/img/onesblog/15e613795b6fe3ad00e917556b6b76c6.jpg"></a></li>
                <li><a href="http://simple.yangqq.com/photo/6.html" title="房前种菜，屋后栽花"><img
                        src="/static/img/onesblog/f805e33f1266f2504739c740084faac7.jpg"></a></li>
                <li><a href="http://simple.yangqq.com/photo/5.html" title="陌上花开，可缓缓归矣"><img
                        src="/static/img/onesblog/d353fb4c75965aef35182a7875186b79.jpg"></a></li>
                <li><a href="http://simple.yangqq.com/photo/4.html" title="云南之行——丽江古镇玉龙雪山"><img
                        src="/static/img/onesblog/6bccfe64820d609bcd0ab7ca7a7fa5dd.jpg"></a></li>
            </ul>
        </div>
        <div class="search">
            <form action="http://simple.yangqq.com/e/search/index.php" method="post" name="searchform" id="searchform">
                <input name="keyboard" id="keyboard" class="input_text" value="请输入关键字词"
                       style="color: rgb(153, 153, 153);"
                       onfocus="if(value==&#39;请输入关键字词&#39;){this.style.color=&#39;#000&#39;;value=&#39;&#39;}"
                       onblur="if(value==&#39;&#39;){this.style.color=&#39;#999&#39;;value=&#39;请输入关键字词&#39;}"
                       type="text">
                <input name="show" value="title" type="hidden">
                <input name="tempid" value="1" type="hidden">
                <input name="tbname" value="news" type="hidden">
                <input name="Submit" class="input_submit" value="搜索" type="submit">
            </form>
        </div>
        <div class="fenlei">
            <h2>分类</h2>
            <div class="tags">
                <div class="tags-header">标签</div>
                <div class="tags-body">
                    <ul>
                        {% for lable in   artical_lable_list %}
                            <li>
                                <a href="/onesindex/{{ user.blog.surfix }}/lable/{{ lable.id }}">{{ lable.caption }}({{ lable.articals_0set.count }})</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="types">
                <div class="types-header">分类</div>
                <div class="types-body">
                    <ul>
                        {% for sort in  artical_sort_list %}
                            <li>
                                <a href="/onesindex/{{ user.blog.surfix }}/sort/{{ sort.id }}">{{ sort.caption }}({{ sort.articals_set.count }})</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="tuijian">
            <h2>点击排行</h2>
            <ul>
                <li><a href="http://simple.yangqq.com/diary/12.html" title="个人博客，我为什么要用帝国cms？">个人博客，我为什么要用帝国cms？</a>
                </li>
                <li><a href="http://simple.yangqq.com/diary/19.html" title="一个三十而立的男程序员真实讲述：代码搅乱我的生活">一个三十而立的男程序员真实讲述：代码搅乱我的生活</a>
                </li>
                <li><a href="http://simple.yangqq.com/photo/21.html" title="古典个人博客模板《青砖屋檐》">古典个人博客模板《青砖屋檐》</a></li>
                <li><a href="http://simple.yangqq.com/diary/8.html" title="个人博客，属于我的小世界！">个人博客，属于我的小世界！</a></li>
                <li><a href="http://simple.yangqq.com/photo/7.html" title="简单手工纸玫瑰">简单手工纸玫瑰</a></li>
                <li><a href="http://simple.yangqq.com/diary/17.html" title="抄袭门过后——丢掉心结，重拾自己">抄袭门过后——丢掉心结，重拾自己</a></li>
                <li><a href="http://simple.yangqq.com/diary/16.html" title="个人博客从简不繁">个人博客从简不繁</a></li>
                <li><a href="http://simple.yangqq.com/photo/20.html" title="个人博客模板《早安》">个人博客模板《早安》</a></li>
            </ul>
        </div>

        <div class="guanzhu">
            <h2>关注我</h2>
            <ul>
                <img src="/static/img/onesblog/f11b9a31f64c7dbb3b9da670cd12f6aa.jpg">
            </ul>
        </div>
    </aside>
    <main class="r_box">
        {% block artical_content %}
            {% for article in artical_list %}
                <div class="blog-post">
                    <h2><a href="/articals/{{ article.id }}">{{ article.title }}</a></h2>
                    <p class="blog-post-meta">{{ article.ctime }} by {{ article.blog }}</p>
                    <p>
                        {{ article.summary }}
                    </p>
                </div>
            {% endfor %}
            <footer>
            <ul class="pagination">
                {{ page_str }}
            </ul>
        {% endblock %}
        </footer>

        <!--推荐模板标签id5-->
    </main>
</article>

<footer>
    <p>Design by <a href="http://simple.yangqq.com/">{{ user.username }}个人博客</a>
        备案号：<a href="http://simple.yangqq.com/">蜀ICP备11002373号-1</a></p>
</footer>
<a href="http://simple.yangqq.com/#" class="cd-top">Top</a>
<script>window.jQuery || document.write('<script src="/static/js/jquery.min.js"><\/script>')</script>
<script src="/static/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/static/js/ie10-viewport-bug-workaround.js"></script>
<script src="/static/js/jquery-3.1.1.min.js"></script>
<script src="/static/js/comm.js"></script>
<script src="/static/plugins/dropzone.js"></script>
{% block script %}
    <script>

        var theDropzone = new $("#drop-avatar").dropzone({
            acceptedFiles: 'image/*',
            maxFilesize: '10',
            addRemoveLinks: 'true',
            method: 'post',
            maxFiles: '1',
            init: function () {
                var _this = this;
                var img = null;
                _this.on('sending', function (file, xhr) {
                    xhr.setRequestHeader('uid', {{ user.uid }});
                });
                _this.on("success", function (file) {
                    $(".dz-success-mark svg").css("background", "green");
                    $(".dz-error-mark").css("display", "none");
                });
                _this.on("error", function (file) {
                    $(".dz-error-mark svg").css("background", "red");
                    $(".dz-success-mark").css("display", "none");
                });
                _this.on('maxfilesexceeded', function (file) {
                    _this.removeAllFiles();
                });

            }

        });

        function FinalImg() {
            var post_ensure = 'None';
            var final_img = $('form div[class="dz-image"]>img').attr('src');
            if (final_img) {
                post_ensure = 'True'
            }
            $.ajax({
                url: '/index/{{ user.blog.surfix }}/PostAvatar/',
                method: 'GET',
                data: {'post_ensure': post_ensure},
                headers: {'uid':{{ user.uid }}},
                success: function (msg) {
                    msg = JSON.parse(msg);
                    if (msg['status']) {
                        alert(msg['status']);
                    } else {
                        alert(msg['error'])
                    }
                    location.reload();
                }
            });

        }

        function previewAvatar(that) {
            var csrftoken = $('form input[name="csrfmiddlewaretoken"]')[0].value;
            var file = that.files[0];
            var formdata = new FormData();
            {#var xhr = new XMLHttpRequest();#}
            {#formdata.append('uid',{{ user.uid }});#}
            formdata.append('image', file);

            $.ajax({
                url: '/index/{{ user.blog.surfix }}/ChangeAvatar/',
                method: 'POST',
                processData: false,
                contentType: false,
                {#data: {'img':formdata,'uid':{{ user.uid }},'csrfmiddlewaretoken':csrftoken},#}
                data: formdata,
                {#dataType:'JSON',#}
                success: function (msg) {
                    msg = JSON.parse(msg);
                    if (msg['status'] === 'true') {
                        document.getElementById('previewAvatar_img').remove(this);
                        var new_img = document.createElement('img');
                        var father_node = document.getElementById('ChangeAvatarForm');
                        new_img.setAttribute('src', msg['img_src']);
                        new_img.setAttribute('id', 'previewAvatar_img');
                        new_img.setAttribute('style', 'width: 100px;height: 100px');
                        father_node.insertBefore(new_img, father_node.firstChild);

                        {#$('#previewAvatar').remove();#}
                        {#new_img.attr('src',msg['img_src'])#}
                        {#new_img.attr({'src':msg['img_src'],'id':'previewAvatar','style':'width: 100px;height: 100px'});#}
                    }
                    else {
                        alert(msg['error']);
                    }
                }


            })
        }

        function beforeSubmitChangeAvatar() {
            var formdata = new FormData();
            var img_file = $('form input[name="Avatarfile"]').files[0];
            console.log(img_file);
            formdata.append('submit_img_file', img_file);
            $.ajax({
                url: '/index/{{ user.blog.surfix }}/ChangeAvatar/',
                processData: false,
                contentType: false,
                async:false,
                type: 'POST',
                data: formdata,
                success: function (msg) {
                    alert(msg);
                    {#location.reload();#}
                }
            });
        }

    </script>
{% endblock %}

</body>
</html>